<!DOCTYPE html>
<!--
/**
 * @author Raoul Harel
 * @license The MIT license (LICENSE.txt)
 * @copyright 2015 Raoul Harel
 * @url https://github.com/rharel/js-steering-behaviors
 */
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pursuit Visual Test [js-steering-behaviors]</title>

    <link rel="stylesheet" href="css/visual_test.css">

    <script src="../../dist/steering_behaviors.js"></script>

    <script src="js/Player.js"></script>
    <script src="js/Simulation.js"></script>
    <script src="js/Renderer.js"></script>
</head>
<body>
<h1>Pursuit behavior visual test</h1>
<script>

    (function() {

        var canvas = document.createElement('canvas');
        canvas.width = 500;
        canvas.height = 500;

        var _2d = canvas.getContext('2d');

        document.body.appendChild(canvas);

        var characters = [];

        var sim = new Simulation();

        var renderer = new Renderer(

                new SB.Vec2(30, 40),
                {stroke: 'black', fill: 'lightgreen', line_width: 2}
        );

        var wandering_agent = {

            character: new SB.Character({

                position: new SB.Vec2(250, 250),
                max_force: 200,
                max_speed: 100
            }),

            behavior: new SB.Behavior.Wander(0.25 * Math.PI, 0.1 * Math.PI, 200)
        };

        var pursuing_agent = {

            character: new SB.Character({

                position: new SB.Vec2(0, 0),
                max_force: 200,
                max_speed: 100
            }),

            behavior: new SB.Behavior.Pursuit(

                wandering_agent.character, 100, false, SB.Predictor.constant(1 / 30)
            )
        };

        sim.agents.push(wandering_agent, pursuing_agent);
        characters.push(wandering_agent.character, pursuing_agent.character);

        var step = (function() {

            var last_time = new Date();

            return function() {

                var current_time = new Date();
                var dt = (current_time - last_time) / 1000;

                sim.step(dt);

                characters.forEach(function(character) {

                    var p = character.position;

                    if (p.x < 0 || p.x > 500) { p.x = 500 - p.x; }
                    if (p.y < 0 || p.y > 500) { p.y = 500 - p.y; }
                });

                last_time = current_time;
            }
        })();

        var world_player = new Player(30, step);

        function render() {

            renderer.render(_2d, characters);
            requestAnimationFrame(render);
        }

        world_player.play();
        render();
    })();
</script>
</body>
</html>